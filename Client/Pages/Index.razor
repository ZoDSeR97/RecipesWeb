@inject HttpClient Http
@inject IJSRuntime JSRuntime
@inject NavigationManager Nav
@using RecipesWeb.Shared
@page "/"

<PageTitle>Index</PageTitle>

<h1 class="font-bold">Hello, world!</h1>

Welcome to your new app.

<EditForm Model="Query" OnValidSubmit="HandleSearch">
    <div class="form-floating mb-3">
        <InputText type="text" class="form-control" placeholder="Recipe Name or Ingredient" @bind-Value="Query.Name" />
        <label for="Name" class="form-label">Recipe Name or Ingredient</label>
        <ValidationMessage For="@(()=>Query.Name)" />
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>
@{
    foreach (Recipe result in results)
    {
        
    }
}

<SurveyPrompt Title="How is Blazor working for you?" />

@code{
    private SearchName Query = new SearchName();
    private List<Recipe> results = new List<Recipe>();

    protected override async void OnInitialized()
    {
        base.OnInitialized();
        var response = await Http.GetFromJsonAsync<Recipe[]>("api/Recipe");
        if(response != null)
            results = response.ToList();
    }

    public async void HandleSearch()
    {
        var findRecipe = await Http.GetFromJsonAsync<Recipe[]>($"api/Recipe/{Query.Name}");
        var findRecipeWithIngredient = await Http.GetFromJsonAsync<Recipe[]>($"api/Ingredient/{Query.Name}");
        if (findRecipe != null)
            results = findRecipe.ToList();
        if (findRecipeWithIngredient != null)
            findRecipeWithIngredient.ToList().ForEach(recipe => results.Add(recipe));
    }
}
